# Домашнее задание к занятию «Резервное копирование баз данных» - Бодарев В.В.

# Задание 1. Резервное копирование.

---

Кейс

Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Для повышения надежности работы баз данных и их резервного копирования финансовая компания может рассмотреть различные варианты резервного копирования в зависимости от требований к восстановлению данных. Рассмотрим три сценария.

1. Восстановление данных в полном объёме за предыдущий день

Рекомендуемый вариант: Полное резервное копирование.

Описание: Полное резервное копирование включает создание полной копии всех данных в базе на определенный момент времени. Это позволяет восстановить базу данных в состоянии на конец предыдущего дня. 

Рекомендуется выполнять полное резервное копирование раз в сутки, например, в ночное время, когда нагрузка на систему минимальна.

2. Восстановление данных за час до предполагаемой поломки

Рекомендуемый вариант: Инкрементальное или дифференциальное резервное копирование.

Описание:
Инкрементальное резервное копирование сохраняет только изменения, сделанные с момента последнего резервного копирования (полного или инкрементального). Это позволяет быстро восстановить данные до состояния за час до поломки, если инкрементальные копии создавались регулярно.

Дифференциальное резервное копирование сохраняет изменения с момента последнего полного бэкапа. Восстановление также возможно, но требует последнего полного и последнего дифференциального бэкапа.

Рекомендуется выполнять инкрементальные бэкапы каждый час, чтобы минимизировать потерю данных.

3. Моментальное переключение на работающую или починенную базу данных

Вариант реализации: Репликация с использованием технологии Master-Slave.

Описание: В этой конфигурации основная база данных (Master) реплицируется на вторичную (Slave). При сбое Master можно быстро переключиться на Slave, что обеспечивает высокую доступность и минимальное время простоя.

---

# Задание 2. PostgreSQL.

---

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

1. Чтобы создать резервную копию базы данных с именем mydb, выполним следующую команду:

pg_dump -Fc mydb > mydb_backup.dump

Чтобы восстановить базу данных из созданной резервной копии используем команду:

pg_restore -C -d postgres mydb_backup.dump

2. Автоматизировать процесс резервного копирования и восстановления можно с помощью скриптов и планировщиков задач.

Например:

Скрипты Shell. Скрипт, который будет выполнять команды pg_dump и pg_restore.

Инструменты, такие как Backup Ninja или pgBackRest, которые предлагают встроенные функции для автоматизации резервного копирования и восстановления PostgreSQL.


---

# Задание 3. MySQL.

---

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

1. Для выполнения инкрементного резервного копирования базы данных MySQL можно использовать утилиту mysqlbackup, которая входит в состав MySQL Enterprise Backup. Вот пример команды для создания инкрементного резервного копирования:

mysqlbackup --defaults-file=/path/to/my.cnf \
--incremental --incremental-base=history:last_backup \
--backup-dir=/path/to/backup/dir \
--backup-image=incremental_image1.bi \
backup-to-image

Преимущества использования реплики по сравнению с обычным резервным копированием:

1.	Минимизация времени простоя: Резервное копирование на реплике позволяет избежать нагрузки на основной сервер, что снижает риск простоя во время выполнения резервного копирования.

2.	Быстрое восстановление: В случае сбоя основной базы данных можно быстро переключиться на реплику, что обеспечивает высокую доступность данных.

3.	Параллельные операции: Реплика может обрабатывать запросы на чтение, что позволяет распределять нагрузку и улучшать производительность системы.

4.	Снижение нагрузки на сеть: Если реплика находится в другом месте, можно выполнять резервное копирование локально, что уменьшает нагрузку на сеть.

5.	Точка восстановления: Реплика может использоваться для создания точек восстановления без необходимости блокировки основной базы данных.

---




